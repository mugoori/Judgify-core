# Phase 9 Manufacturing Workflow Builder - UI 시각화

**생성일**: 2025-11-20
**목적**: Phase 9 Vertical List UI의 구체적인 시각적 레이아웃 확인

---

## 1. 전체 페이지 레이아웃 (Vertical List Paradigm)

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📋 제조 워크플로우 빌더                          [저장] [시뮬레이션] │
│─────────────────────────────────────────────────────────────────────│
│                                                                       │
│  워크플로우 이름: 📝 품질 검사 자동화 워크플로우                    │
│  설명: 실시간 설비 데이터 기반 불량 판단 및 알림                    │
│                                                                       │
│─────────────────────────────────────────────────────────────────────│
│                                                                       │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 🕐 1. [TRIGGER] 매일 오전 9시 실행                           │  │
│  │                                              ⋮ [수정] [삭제]   │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                              ↓                                        │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 📊 2. [QUERY] A라인 온도/진동 데이터 조회                    │  │
│  │                                              ⋮ [수정] [삭제]   │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                              ↓                                        │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 🧮 3. [CALC] 불량률 계산 (불량품/전체 * 100)                 │  │
│  │                                              ⋮ [수정] [삭제]   │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                              ↓                                        │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ ⚖️ 4. [JUDGMENT] 불량률 > 5% 판단                ✅ 실행됨    │  │
│  │                                              ⋮ [수정] [삭제]   │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                         ↙          ↘                                  │
│        (TRUE)                              (FALSE)                    │
│  ┌─────────────────────┐          ┌─────────────────────┐           │
│  │ ✋ 5. [APPROVAL]     │          │ 🔔 6. [ALERT]       │           │
│  │ 라인 정지 승인 요청 │          │ 정상 운영 알림      │           │
│  │        ⋮ [수정] [삭제]│          │        ⋮ [수정] [삭제]│           │
│  └─────────────────────┘          └─────────────────────┘           │
│                                                                       │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                  ➕ 단계 추가 (STEP 추가)                       │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

---

## 2. StepCard 상태별 UI

### 2.1 축소 상태 (Collapsed)

```
┌───────────────────────────────────────────────────────────────────┐
│ ⋮ 📊 2. [QUERY] A라인 온도/진동 데이터 조회         [수정] [삭제]│
│                                                      ▼ 펼치기      │
└───────────────────────────────────────────────────────────────────┘
   ↑   ↑    ↑         ↑                               ↑       ↑
 Drag Icon Order  Node Name                        Actions  Expand
 Handle                                            Button
```

**컴포넌트 구조**:
```tsx
<Card className="step-card collapsed">
  <CardHeader className="flex justify-between items-center">
    <DragHandle icon="⋮" />
    <NodeIcon type="QUERY" emoji="📊" />
    <span className="order-badge">2.</span>
    <CardTitle>[QUERY] A라인 온도/진동 데이터 조회</CardTitle>
    <div className="actions">
      <Button onClick={onEdit}>수정</Button>
      <Button onClick={onDelete} variant="destructive">삭제</Button>
      <Button onClick={toggleExpand}>▼ 펼치기</Button>
    </div>
  </CardHeader>
</Card>
```

### 2.2 확장 상태 (Expanded) - QUERY 노드 예시

```
┌───────────────────────────────────────────────────────────────────┐
│ ⋮ 📊 2. [QUERY] A라인 온도/진동 데이터 조회         [수정] [삭제]│
│                                                      ▲ 접기        │
│─────────────────────────────────────────────────────────────────│
│                                                                   │
│  📝 단계 이름:                                                    │
│  [A라인 온도/진동 데이터 조회_________________________]          │
│                                                                   │
│  🏭 공장 선택:                                                    │
│  [▼ 평택 공장___________________________________]                │
│                                                                   │
│  ⚙️ 라인 선택:                                                    │
│  [▼ A 생산 라인________________________________]                 │
│                                                                   │
│  📊 조회할 데이터:                                                │
│  ☑️ 온도 (temperature)                                            │
│  ☑️ 진동 (vibration)                                              │
│  ☐ 압력 (pressure)                                                │
│  ☐ 습도 (humidity)                                                │
│                                                                   │
│  ⏱️ 조회 기간:                                                     │
│  [▼ 최근 1시간__________________________________]                │
│                                                                   │
│                                      [취소] [저장]                │
└───────────────────────────────────────────────────────────────────┘
```

### 2.3 확장 상태 - JUDGMENT 노드 예시

```
┌───────────────────────────────────────────────────────────────────┐
│ ⋮ ⚖️ 4. [JUDGMENT] 불량률 > 5% 판단                  [수정] [삭제]│
│                                                      ▲ 접기        │
│─────────────────────────────────────────────────────────────────│
│                                                                   │
│  📝 판단 규칙 이름:                                               │
│  [불량률 임계값 초과 판단________________________]               │
│                                                                   │
│  📊 판단 조건 (Rule Expression):                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ defect_rate > 5.0                                            ││
│  │                                                              ││
│  │ 💡 사용 가능한 변수:                                          ││
│  │    - defect_rate: Step 3의 계산 결과                         ││
│  │    - temperature: Step 2의 온도 데이터                       ││
│  │    - vibration: Step 2의 진동 데이터                         ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                   │
│  ✅ TRUE (조건 만족) 시 다음 단계:                                │
│  [▼ Step 5: 라인 정지 승인 요청__________________]               │
│                                                                   │
│  ❌ FALSE (조건 불만족) 시 다음 단계:                             │
│  [▼ Step 6: 정상 운영 알림________________________]              │
│                                                                   │
│  🤖 LLM 보완 활성화:                                              │
│  ☑️ Rule Engine 실패시 GPT-4로 재판단                            │
│  신뢰도 임계값: [0.7_____]                                        │
│                                                                   │
│                                      [취소] [저장]                │
└───────────────────────────────────────────────────────────────────┘
```

### 2.4 확장 상태 - APPROVAL 노드 예시

```
┌───────────────────────────────────────────────────────────────────┐
│ ⋮ ✋ 5. [APPROVAL] 라인 정지 승인 요청                [수정] [삭제]│
│                                                      ▲ 접기        │
│─────────────────────────────────────────────────────────────────│
│                                                                   │
│  📝 승인 요청 제목:                                               │
│  [A라인 긴급 정지 승인 요청________________________]             │
│                                                                   │
│  📄 승인 요청 내용:                                               │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 불량률이 {defect_rate}%로 임계값(5%)을 초과했습니다.        ││
│  │ A라인의 긴급 정지를 승인해주시기 바랍니다.                  ││
│  │                                                              ││
│  │ 📊 현재 상태:                                                 ││
│  │ - 온도: {temperature}°C                                      ││
│  │ - 진동: {vibration}Hz                                        ││
│  │ - 불량률: {defect_rate}%                                     ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                   │
│  👤 승인자 선택:                                                  │
│  ☑️ 생산팀장 (김철수)                                             │
│  ☑️ 품질관리자 (이영희)                                           │
│  ☐ 공장장 (박민수)                                                │
│                                                                   │
│  ⏱️ 승인 대기 시간:                                                │
│  [▼ 30분_________________________________________]               │
│                                                                   │
│  🔔 알림 채널:                                                     │
│  ☑️ Slack                                                         │
│  ☑️ Email                                                         │
│  ☐ SMS                                                            │
│                                                                   │
│                                      [취소] [저장]                │
└───────────────────────────────────────────────────────────────────┘
```

---

## 3. 시뮬레이션 모드 (Inline Highlighting)

시뮬레이션 실행시 각 단계가 순차적으로 하이라이트되며 실행 결과를 표시합니다.

```
┌───────────────────────────────────────────────────────────────────┐
│ 📋 제조 워크플로우 빌더              [저장] [▶️ 시뮬레이션 실행중] │
│─────────────────────────────────────────────────────────────────────│
│                                                                       │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 🕐 1. [TRIGGER] 매일 오전 9시 실행                ✅ 완료     │  │
│  │ 실행 시간: 09:00:00                                           │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                              ↓                                        │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 📊 2. [QUERY] A라인 온도/진동 데이터 조회         ✅ 완료     │  │
│  │ 조회 결과: 온도=85°C, 진동=42Hz (120건)                      │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                              ↓                                        │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 🧮 3. [CALC] 불량률 계산                          ✅ 완료     │  │
│  │ 계산 결과: 7.2% (불량 120건 / 전체 1,667건)                  │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                              ↓                                        │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ ⚖️ 4. [JUDGMENT] 불량률 > 5% 판단                 ⏳ 실행중   │  │
│  │ Rule Engine: TRUE (7.2 > 5.0) ✅                              │  │
│  │ 신뢰도: 0.95 (임계값 0.7 초과)                                │  │
│  │ 판단 방법: rule (LLM 보완 불필요)                             │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                         ↙          ↘                                  │
│        (TRUE)                              (FALSE)                    │
│  ┌─────────────────────┐          ┌─────────────────────┐           │
│  │ ✋ 5. [APPROVAL]   ⏸️│          │ 🔔 6. [ALERT]       │           │
│  │ 라인 정지 승인 요청 │          │ 정상 운영 알림      │           │
│  │ 대기중...           │          │ (실행 안됨)          │           │
│  └─────────────────────┘          └─────────────────────┘           │
│                                                                       │
│  📊 시뮬레이션 결과:                                                  │
│  ✅ 3단계 완료, ⏳ 1단계 대기중, ⏸️ 1단계 스킵                         │
│  실행 시간: 1.2초                                                     │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

---

## 4. "단계 추가" 버튼 클릭시 노드 타입 선택 UI

```
┌───────────────────────────────────────────────────────────────────┐
│  ➕ 어떤 단계를 추가하시겠습니까?                                  │
│                                                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ 🕐 TRIGGER  │  │ 📊 QUERY    │  │ 🧮 CALC     │             │
│  │ 트리거 설정  │  │ 데이터 조회  │  │ 계산 수행   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
│                                                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ ⚖️ JUDGMENT │  │ ✋ APPROVAL │  │ 🔔 ALERT    │             │
│  │ 조건 판단    │  │ 승인 요청    │  │ 알림 전송   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
│                                                                   │
│                                      [취소]                       │
└───────────────────────────────────────────────────────────────────┘
```

선택하면 해당 타입의 빈 StepCard가 확장 상태로 추가됩니다.

---

## 5. 기존 React Flow UI와 비교

### 5.1 기존 Canvas UI (삭제 예정)

```
┌─────────────────────────────────────────────────────────────────────┐
│ WorkflowBuilder.tsx (React Flow)                                    │
│─────────────────────────────────────────────────────────────────────│
│                                                                       │
│  [노드 추가 ▼]  [시뮬레이션 ▶️]  [저장]                              │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                                                               │   │
│  │    ┌──────────┐                                              │   │
│  │    │ TRIGGER  │                                              │   │
│  │    │ 09:00    │────────┐                                     │   │
│  │    └──────────┘        │                                     │   │
│  │                        ↓                                     │   │
│  │                   ┌─────────┐                                │   │
│  │                   │  QUERY  │                                │   │
│  │                   │ A라인    │─────┐                         │   │
│  │                   └─────────┘     │                         │   │
│  │                                   ↓                         │   │
│  │                              ┌─────────┐                     │   │
│  │                              │  CALC   │                     │   │
│  │                              │ 불량률   │───┐                │   │
│  │                              └─────────┘   │                │   │
│  │                                            ↓                │   │
│  │                                      ┌──────────┐           │   │
│  │                                      │ JUDGMENT │           │   │
│  │                       ┌──────────────│ > 5%?    │───┐       │   │
│  │                       │              └──────────┘   │       │   │
│  │                       ↓                             ↓       │   │
│  │                 ┌──────────┐                 ┌──────────┐  │   │
│  │                 │ APPROVAL │                 │  ALERT   │  │   │
│  │                 │ 정지승인  │                 │ 정상알림  │  │   │
│  │                 └──────────┘                 └──────────┘  │   │
│  │                                                               │   │
│  └───────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  [우측 패널: 선택된 노드 속성 편집]                                   │
│  ┌────────────────────────────────────┐                            │
│  │ JUDGMENT Node 설정                 │                            │
│  │ Rule: defect_rate > 5.0            │                            │
│  │ 신뢰도: 0.7                        │                            │
│  └────────────────────────────────────┘                            │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

**문제점**:
- ❌ 모바일에서 사용 불가 (Canvas 조작 어려움)
- ❌ 복잡한 워크플로우(50+ 노드)에서 가독성 저하
- ❌ 노드 위치 조정에 시간 소모
- ❌ 우측 패널 분리로 컨텍스트 전환 많음

### 5.2 Phase 9 Vertical List UI (신규)

```
┌─────────────────────────────────────────────────────────────────────┐
│ WorkflowBuilderV2.tsx (Vertical List)                               │
│─────────────────────────────────────────────────────────────────────│
│                                                                       │
│  워크플로우 이름: 품질 검사 자동화                                    │
│                                                                       │
│  Step 1 ▶ TRIGGER ▶ 09:00 실행                                      │
│    ↓                                                                 │
│  Step 2 ▶ QUERY ▶ A라인 데이터 조회                                 │
│    ↓                                                                 │
│  Step 3 ▶ CALC ▶ 불량률 계산                                        │
│    ↓                                                                 │
│  Step 4 ▶ JUDGMENT ▶ 불량률 > 5% 판단                               │
│    ├─ TRUE → Step 5                                                 │
│    └─ FALSE → Step 6                                                │
│                                                                       │
│  Step 5 ▶ APPROVAL ▶ 라인 정지 승인                                 │
│  Step 6 ▶ ALERT ▶ 정상 운영 알림                                    │
│                                                                       │
│  [➕ 단계 추가]                                                       │
│                                                                       │
└───────────────────────────────────────────────────────────────────────┘
```

**장점**:
- ✅ 모바일 친화적 (스크롤만으로 모든 단계 확인)
- ✅ 실행 순서 명확 (위→아래)
- ✅ 인라인 편집 (컨텍스트 전환 없음)
- ✅ 50+ 단계도 가독성 유지 (Virtual Scrolling)
- ✅ 드래그앤드롭 재정렬 간편

---

## 6. 노드 타입별 아이콘 및 색상 테마

| NodeType | 아이콘 | 색상 | 용도 |
|----------|--------|------|------|
| **TRIGGER** | 🕐 | Blue (#3B82F6) | 스케줄/이벤트 트리거 |
| **QUERY** | 📊 | Green (#10B981) | 데이터베이스 조회 |
| **CALC** | 🧮 | Purple (#8B5CF6) | 수식 계산 |
| **JUDGMENT** | ⚖️ | Orange (#F59E0B) | 조건 판단 (하이브리드) |
| **APPROVAL** | ✋ | Red (#EF4444) | 승인 요청 대기 |
| **ALERT** | 🔔 | Yellow (#FBBF24) | 알림 전송 |

**실행 상태 색상**:
- ⏳ 대기중: Gray (#9CA3AF)
- ⏸️ 실행중: Blue (#3B82F6)
- ✅ 완료: Green (#10B981)
- ❌ 실패: Red (#EF4444)

---

## 7. 반응형 레이아웃 (Mobile vs Desktop)

### Desktop (1400px+)
```
┌─────────────┬─────────────────────────────────────────────┐
│             │  Step 1: TRIGGER                           │
│  좌측 사이드바 │  Step 2: QUERY                             │
│  (템플릿)     │  Step 3: CALC                              │
│             │  Step 4: JUDGMENT                          │
│             │  ...                                        │
└─────────────┴─────────────────────────────────────────────┘
```

### Tablet (768px - 1399px)
```
┌───────────────────────────────────────────────────────┐
│  [☰ 템플릿 메뉴]                                       │
│  Step 1: TRIGGER                                      │
│  Step 2: QUERY                                        │
│  Step 3: CALC                                         │
│  ...                                                   │
└───────────────────────────────────────────────────────┘
```

### Mobile (< 768px)
```
┌─────────────────────┐
│ [☰]  워크플로우 빌더  │
│                     │
│ Step 1: TRIGGER     │
│                     │
│ Step 2: QUERY       │
│                     │
│ Step 3: CALC        │
│                     │
│ [➕ 단계 추가]        │
└─────────────────────┘
```

---

## 8. 드래그앤드롭 재정렬 인터랙션

**Before Drag**:
```
Step 1: TRIGGER
Step 2: QUERY
Step 3: CALC      ← 이 단계를 위로 이동하고 싶음
Step 4: JUDGMENT
```

**During Drag** (react-beautiful-dnd):
```
Step 1: TRIGGER
┌─────────────────┐ ← Drop Zone (파란색 하이라이트)
│                 │
└─────────────────┘
Step 2: QUERY
┌─────────────────┐
│ Step 3: CALC    │ ← 드래그 중 (반투명)
└─────────────────┘
Step 4: JUDGMENT
```

**After Drop**:
```
Step 1: TRIGGER
Step 2: CALC       ← 순서 자동 재정렬
Step 3: QUERY
Step 4: JUDGMENT
```

---

## 9. 구현 우선순위별 UI 컴포넌트

### 🥇 Phase A-1: 핵심 컴포넌트 (10시간)
1. **WorkflowBuilderV2.tsx** - 메인 레이아웃
2. **StepCard.tsx** - 축소/확장 상태
3. **AddStepButton.tsx** - 노드 타입 선택 모달

### 🥈 Phase A-2: 폼 컴포넌트 (8시간)
4. **StepConfigForm.tsx** - 동적 폼 렌더링
5. **TriggerConfig.tsx** - Cron 입력
6. **QueryConfig.tsx** - Factory/Line 선택
7. **CalcConfig.tsx** - 수식 입력
8. **JudgmentConfig.tsx** - Rule 조건
9. **ApprovalConfig.tsx** - 승인자 선택
10. **AlertConfig.tsx** - 알림 채널

### 🥉 Phase A-3: 부가 기능 (5시간)
11. **SimulationInlineView.tsx** - 인라인 시뮬레이션
12. **StepReorderHandle.tsx** - 드래그앤드롭

---

## 10. 사용자 시나리오별 UI 플로우

### 시나리오 1: 빈 워크플로우 생성

```
[Step 1] 워크플로우 빌더 페이지 진입
  ↓
[Step 2] 워크플로우 이름 입력: "품질 검사"
  ↓
[Step 3] "➕ 단계 추가" 버튼 클릭
  ↓
[Step 4] 노드 타입 선택 모달 → "TRIGGER" 선택
  ↓
[Step 5] TRIGGER 카드가 확장 상태로 추가됨
  ↓
[Step 6] Cron 입력: "0 9 * * *" (매일 오전 9시)
  ↓
[Step 7] "저장" 버튼 클릭 → 축소 상태로 전환
  ↓
[Step 8] 반복: QUERY → CALC → JUDGMENT → APPROVAL → ALERT
```

### 시나리오 2: 기존 워크플로우 편집

```
[Step 1] 워크플로우 목록에서 "품질 검사" 선택
  ↓
[Step 2] 6개 단계가 축소 상태로 표시됨
  ↓
[Step 3] "Step 3: CALC" 카드 클릭 → 확장
  ↓
[Step 4] 계산 수식 수정: "불량품/전체 * 100"
  ↓
[Step 5] "저장" 버튼 클릭 → 축소 상태로 복귀
  ↓
[Step 6] "시뮬레이션" 버튼 클릭
  ↓
[Step 7] 각 단계가 순차적으로 실행되며 결과 표시
```

### 시나리오 3: 단계 재정렬

```
[Step 1] "Step 3: CALC" 카드의 Drag Handle(⋮) 클릭
  ↓
[Step 2] 마우스로 위로 드래그
  ↓
[Step 3] Drop Zone(파란색 하이라이트) 확인
  ↓
[Step 4] "Step 2" 위치에 드롭
  ↓
[Step 5] 순서 자동 재정렬: CALC이 Step 2가 됨
  ↓
[Step 6] 연결 관계 자동 업데이트
```

---

## 11. 최종 비교: Canvas vs Vertical List

| 비교 항목 | React Flow Canvas | Phase 9 Vertical List |
|----------|-------------------|----------------------|
| **모바일 지원** | ❌ 불가 (드래그 어려움) | ✅ 완벽 (터치 스크롤) |
| **50+ 노드 가독성** | ❌ 겹침/줌 필요 | ✅ Virtual Scrolling |
| **학습 곡선** | 🟡 중간 (Canvas 조작) | ✅ 낮음 (리스트 직관적) |
| **편집 효율** | 🟡 노드+패널 분리 | ✅ 인라인 편집 |
| **실행 순서** | 🟡 시각적이지만 복잡 | ✅ 명확 (위→아래) |
| **개발 복잡도** | 🟡 높음 (500KB) | ✅ 낮음 (200KB) |
| **유지보수** | 🟡 React Flow 의존성 | ✅ 순수 React |

---

**결론**: Phase 9 Vertical List UI는 모바일 친화성, 가독성, 유지보수성에서 기존 Canvas UI를 크게 개선합니다.
