# MES 데이터 누적 기능 업데이트 완료

## 변경 사항

### 1. 데이터 업로드 동작 변경
**이전**: 같은 세션의 데이터를 업로드하면 기존 데이터가 삭제되고 새 데이터로 대체됨
**현재**: 모든 업로드된 데이터가 누적되어 저장됨 (세션 관계없이)

### 2. 코드 수정 내역

#### `src-tauri/src/services/mes_data_service.rs`

1. **DELETE 문 제거** (줄 59-63)
   - 이전: `DELETE FROM mes_data_logs WHERE session_id = ?1`
   - 현재: 삭제 구문 제거, 데이터 누적을 위한 주석 추가

2. **쿼리 범위 확장** (줄 148-160)
   - 이전: 특정 세션의 데이터만 검색
   - 현재: 모든 누적된 데이터에서 검색
   ```sql
   -- 이전
   SELECT COUNT(*) FROM mes_data_logs WHERE session_id = ?1

   -- 현재
   SELECT COUNT(*) FROM mes_data_logs
   ```

3. **FTS5 검색 쿼리 수정** (줄 201-213)
   - 이전: `WHERE f.content MATCH ?1 AND m.session_id = ?2`
   - 현재: `WHERE f.content MATCH ?1` (세션 필터 제거)

4. **LIKE 검색 쿼리 수정** (줄 229-240)
   - 이전: `WHERE session_id = ?1 AND content LIKE ?2`
   - 현재: `WHERE content LIKE ?1` (세션 필터 제거)

5. **전체 데이터 샘플링 쿼리 수정** (줄 257-266)
   - 이전: `WHERE session_id = ?1 ORDER BY row_index DESC`
   - 현재: `ORDER BY id DESC` (세션 필터 제거)

## 동작 방식

### 데이터 업로드
1. CSV 파일 업로드 시 데이터가 `mes_data_logs` 테이블에 저장
2. 세션 ID와 파일명이 함께 저장되어 추적 가능
3. 기존 데이터를 삭제하지 않고 계속 누적

### 데이터 조회
1. 사용자가 "온도가 90도 이상인 데이터 보여줘" 같은 질문
2. 전체 누적 데이터에서 검색 (모든 세션 데이터 포함)
3. FTS5 → LIKE → 전체 샘플링 순서로 검색 시도
4. 검색된 원시 데이터를 그대로 표시

## 장점
- 여러 파일의 데이터를 누적하여 종합적인 분석 가능
- 과거 업로드한 데이터도 계속 활용 가능
- 세션이 바뀌어도 데이터 유지

## 주의사항
- 데이터가 계속 누적되므로 장기간 사용 시 DB 크기 증가
- 필요시 수동으로 오래된 데이터 정리 필요
- 현재 최대 10,000행까지 업로드 가능 (파일당)

## 테스트 방법
1. 첫 번째 CSV 파일 업로드
2. 데이터 조회 (예: "온도 90도 이상")
3. 두 번째 CSV 파일 업로드
4. 다시 조회하면 두 파일의 데이터가 모두 검색됨

## 완료 시간
2025-11-20 09:57 KST